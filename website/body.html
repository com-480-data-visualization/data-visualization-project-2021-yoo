<div class="jumbotron text-center" style="margin-bottom:0; max-height: max-content;">
    <h1>EURO 2021</h1>
</div>

<br>

<div class="row justify-content-center" id='ec_group'>
    <div class="table col-2">
        <table class="table table-borderless table_rounded" id="ec_group">
            <thead>
                <tr>
                    <th class="col-3">Group A</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-tr"></span> Turkey</div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-it"></span> Italy</div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-gb-wls"></span> Wales
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-ch"></span> Switzerland
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="table col-2">
        <table class="table table-borderless table_rounded" id="ec_group">
            <thead>
                <tr>
                    <th class="col-3">Group B</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="col-3">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-dk"></span> Denmark</div>
                    </td>
                </tr>
                <tr>
                    <td class="col-3">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-fi"></span> Finland</div>
                    </td>
                </tr>
                <tr>
                    <td class="col-3">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-be"></span> Belgium</div>
                    </td>
                </tr>
                <tr>
                    <td class="col-3">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-ru"></span> Russia</div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="table col-2">
        <table class="table table-borderless table_rounded" id="ec_group">
            <thead>
                <tr>
                    <th class="col-1">Group C</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-nl"></span> Netherlands
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-ua"></span> Ukraine</div>
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-at"></span> Austria</div>
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-mk"></span> North
                            Macedonia</div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="table col-2">
        <table class="table table-borderless table_rounded" id="ec_group">
            <thead>
                <tr>
                    <th class="col-1">Group D</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-gb"></span> England</div>
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-hr"></span> Croatia</div>
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-cz"></span> Czech
                            Republic</div>
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-gb-sct"></span> Scotland
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="table col-2">
        <table class="table table-borderless table_rounded" id="ec_group">
            <thead>
                <tr>
                    <th class="col-1">Group E</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-es"></span> Spain
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-se"></span> Sweden
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-pl"></span> Poland
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-sk"></span> Slovakia
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="table col-2">
        <table class="table table-borderless table_rounded" id="ec_group">
            <thead>
                <tr>
                    <th class="col-1">Group F</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-pt"></span> Portugal
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-fr"></span> France
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-de"></span> Germany
                    </td>
                </tr>
                <tr>
                    <td class="col-1">
                        <div id="yes-drop" class="drag-drop"> <span class="flag-icon flag-icon-hu"></span> Hungary
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="table" id='dropzone'>
    <table class="table" id='dropzone'>
        <tr>
            <td>
                <div id="outer-dropzone" class="dropzone left_drop">Drop the first team here</div>
            </td>
            <td>
                <div class='vs'>VS</div>
            </td>
            <td>
                <div id="outer-dropzone" class="dropzone right_drop">Drop the second team here</div>
            </td>
        </tr>
    </table>
</div>

<p></p>
<div class="row inactive justify-content-center" id='best_players'>
    <div class="table col">
        <table class="table table-borderless table_rounded inactive" id='team_left_table'>
            <thead>
                <tr>
                    <th>Position</th>
                    <th>Player</th>
                    <th>Rating</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <div class="table col">
        <table class="table table-borderless table_rounded inactive" id="team_right_table">
            <thead>
                <tr>
                    <th>Position</th>
                    <th>Player</th>
                    <th>Rating</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

<div class="tooltip bs-tooltip-top" role="tooltip">
    <div class="arrow"></div>
    <div class="tooltip-inner">
        Some tooltip text!
    </div>
</div>

<script type="text/javascript" src="website/js/ste_wek.js">
</script>


<script>

    const position_dict = { "GK": "Goalkeeper", "CB": "Center-back", "LCB": "Left center-back", "RCB": "Right center-back", "LB": "Left-back (Full-back)", "RB": "Right-back (Full-back)", "CM": "Centre midfield", "LDM": "Left center midfield", "LAM": "Left attacking midfield", "RDM": "Right center midfield", "RAM": "Right attacking midfield", "CDM": "Centre defensive midfield", "CAM": "Centre attacking midfield", "LM": "Left midfield", "RM": "Right midfield", "ST": "Striker", "CF": "Center forward", "LW": "Left winger", "RW": "Right winger", "LWV": "Left wing back", "RWV": "Right wing back" }
    /* The dragging code for '.draggable' from the demo above
     * applies to this demo as well so it doesn't have to be repeated. */

    function dragMoveListener(event) {
        var target = event.target
        // keep the dragged position in the data-x/data-y attributes
        var x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx
        var y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy

        // translate the element
        target.style.transform = 'translate(' + x + 'px, ' + y + 'px)'

        target.setAttribute('data-x', x)
        target.setAttribute('data-y', y)

    }

    var left_team = 0
    var right_team = 0

    // enable draggables to be dropped into this
    interact('.dropzone').dropzone({
        // only accept elements matching this CSS selector
        accept: '#yes-drop',
        // Require a 75% element overlap for a drop to be possible
        overlap: 0.75,

        // listen for drop related events:

        ondropactivate: function (event) {
            event.target.classList.add('drop-active')
        },
        ondragenter: function (event) {
            var draggableElement = event.relatedTarget
            var dropzoneElement = event.target
            // feedback the possibility of a drop
            dropzoneElement.classList.add('drop-target')
            draggableElement.classList.add('can-drop')
        },
        ondragleave: function (event) {
            // remove the drop feedback style
            event.target.classList.remove('drop-target')
            event.relatedTarget.classList.remove('can-drop')
            // event.relatedTarget.textContent.add('Dragged out 1')
        },
        ondrop: function (event) {
            var draggableElement = event.relatedTarget
            var dropzoneElement = event.target
            event.stopImmediatePropagation()
            team = draggableElement.getElementsByTagName('span')[0].cloneNode(true)
            dropzoneElement.classList.add('dropped')
            dropzoneElement.replaceChildren(team)
            team = draggableElement.textContent.replace(/^\s+|\s+$/gm, '')
            if (dropzoneElement.classList.contains('left_drop')) { left_team = team }
            if (dropzoneElement.classList.contains('right_drop')) { right_team = team }
            if (left_team != 0) {
                best_players_table(left_team, 'left')
                first_team = left_team
                att_team = first_team
                setFirstTeamNameAndFlag()
            }
            if (right_team != 0) {
                best_players_table(right_team, 'right')
                second_team = right_team
                def_team = second_team
                setSecondTeamNameAndFlag()
            }


        },
        ondropdeactivate: function (event) {
            // remove active dropzone feedback
            event.target.classList.remove('drop-active')
            event.target.classList.remove('drop-target')

        },
    })

    interact('.drag-drop')
        .draggable({
            inertia: true,
            modifiers: [
                interact.modifiers.restrict({
                    restriction: '#outer-dropzone.dropzone',
                    endOnly: true
                })
            ],
            autoScroll: true,
            // dragMoveListener from the dragging demo above
            listeners: { move: dragMoveListener },
        })
        .on('dragend', function (event) {
            console.log('dragend')
            var target = event.target
            // add active dropzone feedback
            if (!target.classList.contains('dropped')) {
                target.setAttribute('data-x', 0)
                target.setAttribute('data-y', 0)
                target.style.transform = 'translate(' + 0 + 'px, ' + 0 + 'px)'
            }
        })



    function best_players_table(team, pos) {
        $.getJSON('data/teams_basic_skills.json',
            function (data) {
                top_team = data.filter(x => x.str_nationality == team)
                    .sort((x, y) => y.int_overall_rating - x.int_overall_rating)
                    .filter((x, idx) => idx < 5);
                $("#team_" + pos + "_table tbody").empty()
                top_team.forEach((item, i) => {
                    best_position = item['str_best_position']
                    position_explain = position_dict[best_position]
                    $("#team_" + pos + "_table").append("<tr><td><span id='tooltip_position' data-toggle='tooltip' title='" +
                        position_explain + "'>" + best_position
                        + "</span></td><td>" + item['Name'] + "</td><td>"
                        + item["int_overall_rating"] + "</td></tr>")
                });
                $("#best_players").removeClass('inactive')
                $("#team_" + pos + "_table").removeClass('inactive')

            })
    }


    $(document).ready(function () {
        $("body").tooltip({ selector: '[data-toggle=tooltip]' });
    });

    $('#tooltip_position').on(function () {
    })


</script>